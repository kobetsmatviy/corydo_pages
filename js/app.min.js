$(function(){var t,e;console.clear(),console.log(corydoData);let o=$("#chartRender"),a=$("#chartLegend"),n=corydoData.chart,i=corydoData.coin,l=null,r=function t(){let e=(()=>{if(navigator.userAgentData&&"boolean"==typeof navigator.userAgentData.mobile)return navigator.userAgentData.mobile?1:0;let t=navigator.userAgent.toLowerCase(),e=/android|iphone|ipad|ipod|harmonyos|mobile/.test(t),o=800>=Math.min(screen.width,screen.height),a=navigator.maxTouchPoints>1;return e||a&&o?1:0})(),o=window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone?1:0;return{isMobile:e,isPWA:o}}(),s,c;l=(t=n,s=performance.now(),l=echarts.init(o.get(0)),N(t),c=performance.now(),console.log(`Chart (init): ${c-s} ms`),l);let d={trend:$("#eventTrend"),bestExchange:$("#eventBestExchange"),money:$("#eventMoney"),goodTime:$("#eventGoodtime"),risk:$("#eventRisk"),washTrading:$("#eventWashtrading")},p,h;e=corydoData,function t(){if(!d||!d.goodTime||!d.goodTime.length)return;let e=[{name:"Day",color:"#b5e339"},{name:"Week",color:"#7ae84f"},{name:"Month",color:"#00e396"},{name:"Half Year",color:"#0ac2a9"}].map((t,e)=>({name:t.name,type:"gauge",startAngle:145,endAngle:35,radius:`${50+15*e}%`,center:["50%","65%"],pointer:{show:!1},progress:{show:!0,width:10,overlap:!1,roundCap:!1,itemStyle:{color:t.color}},axisLine:{lineStyle:{width:10,color:[[1,"#333333"]]}},splitLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1},detail:{show:!1},data:[{value:0}],silent:!0}));(p=echarts.init(d.goodTime.get(0))).setOption({animation:!1,backgroundColor:"#1a1a1a",series:e,graphic:[]})}(),function t(){if(!d||!d.bestExchange||!d.bestExchange.length)return;let e=[{text:"0.5%",color:"#b5e339",left:0},{text:"1%",color:"#7ae84f",left:55},{text:"2.5%",color:"#07c887",left:100},{text:"5%",color:"#10ac97",left:155},{text:"10%",color:"#0f757b",left:200}],o=[{type:"group",bottom:0,left:"center",silent:!0,width:50*e.length,height:14,children:e.map((t,e)=>({type:"group",left:t.left,top:0,children:[{type:"rect",shape:{width:60,height:14},style:{fill:"transparent"}},{type:"circle",left:0,top:1,shape:{r:6},style:{fill:t.color}},{type:"text",left:16,top:1.5,style:{text:t.text,fill:t.color,font:"bold 11px sans-serif"}}]}))}];(h=echarts.init(d.bestExchange.get(0))).setOption({backgroundColor:"#1a1a1a",animation:!1,grid:{left:"5%",right:"5%",bottom:"10%",top:"5%",containLabel:!0},color:e.map(t=>t.color),tooltip:{show:!1},legend:{show:!1},xAxis:{type:"category",axisLabel:{color:"#aaa"},axisLine:{lineStyle:{color:"#222"}}},yAxis:{type:"value",splitNumber:3,axisLabel:{formatter:t=>"$"+K(t),color:"#aaa"},axisLine:{lineStyle:{color:"#222"}},splitLine:{lineStyle:{color:"#222"}}},series:[],graphic:o})}(),P(e);let f=$("#formDateInput"),m=$("#date__reset"),g=[],u=new Date().toISOString().split("T")[0],_="",y="",x=flatpickr(f,{mode:"range",dateFormat:"Y-m-d",minDate:"2024-06-18",maxDate:u,onChange:function(t){if(1===t.length)_="",y="";else if(2===t.length){var e;let o,[a,n]=t,i=a.toDateString()===n.toDateString(),l=new Date((e=n,o=new Date(e),o.setHours(23,59,59,0),o.getTime()));_=l.toISOString().replace(/\.\d{3}Z$/,"Z"),console.clear(),console.log(l),console.log(_),y=i?"":`${Math.round((n-a)/864e5)+1}d`,$("#dateImg").addClass("date__active"),m.show()}console.log("CALENDAR (utc-0): "+_+" + "+y),g=[]},onClose:function(t){g=2===t.length?t.map(t=>t.toISOString()):[]}});function b(){_="",g=[],x.clear(),m.hide(),$("#dateImg").removeClass("date__active")}m.on("click",function(){y="",b()});let v=$("#formCoinInput"),w=$("#formCoinIcon"),k=$("#formCoinDropdown"),C=-1,S="",L=$(".option__dropdown");L.on("click",".dropdown__selected",function(){let t=$(this).closest(".option__dropdown"),e=t.find(".dropdown__list");$(".dropdown__list").not(e).hide(),e.toggle()}),L.on("click",".list__item",function(){let t=$(this),e=t.closest(".option__dropdown"),o=e.find(".dropdown__selected"),a=e.find(".dropdown__list"),n=t.html(),i=t.data("value");o.attr("data-value",i).html(n),e.find(".list__item").removeClass("item__active"),t.addClass("item__active"),a.hide(),"optionPeriod"===e.attr("id")&&(y=i,b()),"optionExchange"===e.attr("id")&&(S=i),W.submit()}),$(document).on("click",function(t){$(t.target).closest(".option__dropdown").length||$(".dropdown__list").hide()});let T=$("#copyLinkBar"),D=$("#copyLinkURL"),A=$("#copyLinkButton");T.on("dblclick",function(){D.select()}),A.click(function(){let t=D.val();navigator.clipboard.writeText(t).then(()=>{let t=$(this);t.text("copied"),t.addClass("animation__copy"),setTimeout(()=>{t.text("copy"),t.removeClass("animation__copy")},2e3)})}),D.on("copy",function(t){t.preventDefault();let e=D.val(),o=`https://${e}`;t.originalEvent.clipboardData?t.originalEvent.clipboardData.setData("text/plain",o):window.clipboardData&&window.clipboardData.setData("Text",o)});let z=$("#chartToggle .toggle__button");z.on("click",function(){if($(this).hasClass("button__active"))return;z.removeClass("button__active"),$(this).addClass("button__active");let t;$(this).data("type")});let I=[],E=!1,M=$(),W=$("#FormCoinSubmit"),O=$("input[name=formCoin]");function N(t){let e=performance.now(),n=Array.isArray(t.price)&&t.price.some(t=>null!=t);if(!n){l.clear(),a.hide(),l.setOption({backgroundColor:"#1a1a1a",graphic:[{type:"text",left:"center",top:"middle",z:1e3,style:{text:"No data available\n\n(•́︵•̀)",fill:"#888",font:"bold 14px Montserrat",textAlign:"center"},silent:!0}]});return}a.show();let i=t.categories.map(j),s=t.price,c={buy1:t.buy1,buy2:t.buy2,buy3:t.buy3,buy4:t.buy4,buy5:t.buy5,buy6:t.buy6},d={sell1:t.sell1,sell2:t.sell2,sell3:t.sell3,sell4:t.sell4,sell5:t.sell5,sell6:t.sell6},p=i.map((t,e)=>[t,s[e],c.buy1[e],c.buy2[e],c.buy3[e],c.buy4[e],c.buy5[e],c.buy6[e],d.sell1[e],d.sell2[e],d.sell3[e],d.sell4[e],d.sell5[e],d.sell6[e]]),h=[{text:"line",color:"#c7c7c7",bottom:40,left:50},{text:"$0+",color:"#a3e372",bottom:20,left:50},{text:"$100+",color:"#7fce4e",bottom:20,left:95},{text:"$1K+",color:"#4e9e23",bottom:20,left:152},{text:"$5K+",color:"#45881f",bottom:20,left:202},{text:"$20K+",color:"#3b721a",bottom:20,left:255},{text:"$100K+",color:"#315c15",bottom:20,left:315},{text:"$0-",color:"#e06b83",bottom:0,left:50},{text:"$100-",color:"#cc4464",bottom:0,left:95},{text:"$1K-",color:"#a12343",bottom:0,left:152},{text:"$5K-",color:"#8a1d39",bottom:0,left:202},{text:"$20K-",color:"#73172f",bottom:0,left:255},{text:"$100K-",color:"#5c1125",bottom:0,left:315}],f={padding:6,markerSize:12,spacing:4,rowHeight:20,charWidth:7,customLabelColors:["#3b721a","#4e9e23","#a3e372","#e06b83","#a12343","#73172f"],yTicks:6,splitNumber:r.isMobile?5:10,chartSize:{width:o.width(),height:o.height()-17},grid:{top:20,bottom:75,left:8,right:8},colors:["#ffffff","#a3e372","#7fce4e","#4e9e23","#45881f","#3b721a","#315c15","#e06b83","#cc4464","#a12343","#8a1d39","#73172f","#5c1125"]},m=function t(e){for(let o=e.length-1;o>=0;o--){let a=e[o];if(null!==a&&0!==a)return a}return null}(s),{priceMin:g,priceMax:u}=function t(e){let o=null,a=null;for(let n of e)null!==n&&0!==n&&((null===o||n<o)&&(o=n),(null===a||n>a)&&(a=n));return{priceMin:o,priceMax:a}}(s),_={min:Math.min(g,+(.9*m)),max:Math.max(u,+(1.1*m))},y=t.tradesMax,x={min:-y,max:y};_.interval=+((_.max-_.min)/(f.yTicks-1)),x.interval=(x.max-x.min)/(f.yTicks-1);let b={width:f.chartSize.width-f.grid.left-f.grid.right,height:f.chartSize.height-f.grid.top-f.grid.bottom},v=-(U(m).length*f.charWidth+8),w=h.map(t=>({type:"group",left:t.left,bottom:t.bottom,onclick(){},onmouseover:()=>l.dispatchAction({type:"highlight",seriesName:t.text.trim()}),onmouseout:()=>l.dispatchAction({type:"downplay",seriesName:t.text.trim()}),children:[{type:"rect",shape:{width:60,height:f.rowHeight},style:{fill:"transparent"}},{type:"circle",left:f.padding,top:(f.rowHeight-f.markerSize)/2,shape:{r:f.markerSize/2},style:{fill:t.color}},{type:"text",left:f.padding+f.markerSize+f.spacing,top:(f.rowHeight-11)/2,style:{text:t.text,fill:t.color,font:"bold 11px Montserrat"}}]})),k=[];for(let C=0;C<f.yTicks;C++){let S=C/(f.yTicks-1),L=f.grid.top+S*b.height;k.push({type:"line",shape:{x1:f.grid.left,y1:L,x2:f.chartSize.width-f.grid.right,y2:L},style:{stroke:"#444",lineWidth:1,lineDash:[4,4]},silent:!0}),k.push({type:"text",right:f.grid.right,y:L-6-10,z:3,silent:!0,style:{text:U(_.max-C*_.interval),fill:"#aaa",font:"bold 11px Montserrat",align:"right",stroke:"#222",lineWidth:2}}),k.push({type:"text",x:f.grid.left,y:L-6-10,z:3,silent:!0,style:{text:K(x.max-C*x.interval),fill:f.customLabelColors[C]||"#aaa",font:"bold 11px Montserrat",align:"left",stroke:"#222",lineWidth:2}})}let T={backgroundColor:"#1a1a1a",grid:{...f.grid,containLabel:!0},dataset:{source:p},xAxis:{type:"time",position:"bottom",offset:3,splitNumber:f.splitNumber,axisLine:{lineStyle:{width:2,color:"#444"},onZero:!1},axisLabel:{color:"#888",fontSize:11}},yAxis:[{show:!1,type:"value",position:"right",nice:!1,interval:_.interval,min:_.min,max:_.max,axisLine:{lineStyle:{color:"#888"}},axisLabel:{inside:!0,color:"#aaa",align:"right",margin:0,formatter:t=>U(t)+"\n\n"},splitLine:{show:!0}},{show:!1,type:"value",position:"left",nice:!1,interval:x.interval,min:x.min,max:x.max,axisLine:{lineStyle:{color:"#888"}},axisLabel:{inside:!0,color:"#aaa",align:"left",margin:0,formatter:t=>K(t)+"\n\n"},splitLine:{show:!1}}],color:f.colors,series:[{animation:!1,name:"line",type:"line",yAxisIndex:0,encode:{x:0,y:1},smooth:.1,lineStyle:{width:5},showSymbol:!1,emphasis:{focus:"series"},silent:!0,markPoint:{symbol:"rect",symbolSize:[0,0],label:{show:!0,position:"right",offset:[v,0],formatter:()=>U(m),backgroundColor:"#fff",borderRadius:4,padding:[4,6],color:"#111",fontWeight:"bold",fontSize:"11px"},data:[{coord:[i[i.length-1],m]}]}},...h.slice(1).map((t,e)=>({animation:!1,name:t.text,type:"bar",stack:"trades",yAxisIndex:1,encode:{x:0,y:e+2},barWidth:5,emphasis:{focus:"series"},silent:!0}))],textStyle:{fontFamily:"Montserrat"},tooltip:{show:!1},dataZoom:[],graphic:[...w,...k]};l.setOption(T,!0);let D=performance.now();console.log(`Chart (upd): ${D-e} ms`)}function P(t){(function t(e){if(!d||!d.goodTime||!d.goodTime.length||!e||!Array.isArray(e.data))return;let o=[{name:"Half Year",color:"#0ac2a9",dataIndex:3},{name:"Month",color:"#00e396",dataIndex:2},{name:"Week",color:"#7ae84f",dataIndex:1},{name:"Day",color:"#b5e339",dataIndex:0}],a=[{name:"Day",color:"#b5e339"},{name:"Week",color:"#7ae84f"},{name:"Month",color:"#00e396"},{name:"Half Year",color:"#0ac2a9"}].map((t,o)=>({...p.getOption().series[o],data:[{value:null!=e.data[o]?e.data[o]:0}]})),n=Math.ceil(o.length/2),i=o.map((t,o)=>{let a=e.data[t.dataIndex],i=null!=a?`${t.name}: ${a}%`:`${t.name}: N/A`;return{type:"group",left:o%2*100-50,top:20*Math.floor(o/2)-(n-1)*20/2,layout:"horizontal",children:[{type:"circle",shape:{r:6},style:{fill:t.color}},{type:"text",left:12,top:-5,style:{text:i,fill:t.color,font:"11px sans-serif"}}]}});p.setOption({series:a,graphic:[{type:"group",left:"10%",top:"65%",bounding:"all",silent:!0,children:i}]})})(t.goodTime),function t(e){if(!d.bestExchange.length)return;if(!e||!Array.isArray(e.names)||!Array.isArray(e.data)||!Array.isArray(e.exchanges)||0===e.names.length||0===e.data.length||0===e.exchanges.length){console.warn("UpdateBestExchange: data is unavailable"),h.setOption({xAxis:{data:[]},series:[]});return}let o=e.names.map((t,o)=>({name:t,data:Array.isArray(e.data[o])?e.data[o]:[],type:"bar",stack:"total",barWidth:"50%",silent:!0,itemStyle:{borderRadius:o===e.names.length-1?[5,5,0,0]:0}}));h.setOption({xAxis:{data:e.exchanges},series:o})}(t.bestExchange),function t(e){if(!d.trend.length)return;let o=e?.data!=null?String(e.data):"no data";d.trend.text(o)}(t.trend),function t(e){if(!d.money.length)return;let o=e?.data!=null?U(e.data):"no data";d.money.text(o)}(t.money),function t(e){if(!d.risk.length)return;let o=e?.data!=null?String(e.data):"no data";d.risk.text(o)}(t.risk)}function j(t){let e=1e3*t,o=new Date(e),a=6e4*o.getTimezoneOffset();return e-a}function H(t){let e=new Date(t),o=6e4*e.getTimezoneOffset();return t+o}function K(t){if(isNaN(t)||null===t)return t;let e=t<0?"-":"",o=Math.abs(t),a=(t,o)=>{let a=t.toPrecision(3);return a.includes(".")?e+parseFloat(a)+o:e+a+o};return o>=1e12?a(o/1e12,"T"):o>=1e9?a(o/1e9,"B"):o>=1e6?a(o/1e6,"M"):o>=1e3?a(o/1e3,"K"):e+Math.trunc(o)}function U(t){if(isNaN(t)||null===t)return t;t=Number(t);let e=Math.abs(t),o=Math.floor(e).toString().length;if(o>=3)return String(Math.trunc(t));if(e>=1){let a=t.toFixed(10),[n,i=""]=a.split("."),l=n,r=3-n.replace("-","").length;return r>0&&i.length>0&&(l+="."+i.slice(0,r)),l}{let s=t.toFixed(15),c=s.match(/^(-?0\.0*)(\d{1,3})/);return c?c[1]+c[2]:t}}function R(t){var e;(function t(e){let o=e?.ticker&&"string"==typeof e.ticker&&e.ticker.length>0;if(o){v.val(e.ticker);let a=`https://www.gate.io/images/coin_icon/64/${e.tickerLower}.png`;w.find("img").attr("src",a)}else v.val(""),w.html('<img src="/img/coin/_ghost.png" />')})(t.coin),"string"==typeof(e=t.copyLink)&&e.length>0?D.val(e):D.val(""),function t(e){if(!e||!e.calendar){b();return}let{end:o,period:a}=e.calendar,n=a.match(/^(\d+)d$/),i=n?parseInt(n[1]):1,l=new Date(o),r=new Date(l);r.setUTCDate(l.getUTCDate()-i+1),x.setDate([r,l]),_=o,y=a,$("#dateImg").addClass("date__active"),m.show()}(t.period),function t(e){if(!e)return;let o=$("#optionPeriod"),a=o.find(".list__item"),n=o.find(".dropdown__selected"),i='.list__item[data-value="calendar"]';if(a.removeClass("item__active"),e.presetPeriod){y=e.presetPeriod;let l=a.filter(`[data-value="${y}"]`);if(l.length){let r=l.html();n.attr("data-value",y).html(r),l.addClass("item__active")}o.find(i).remove()}else if(e.calendar){let{span:s,tick:c}=e.calendar,d=`
                <li class="list__item item__active" data-value="calendar">
                    <span class="dropdown__name">${s}</span>
                    <span class="dropdown__value">${c}</span>
                </li>
            `;o.find(i).remove(),o.find(".dropdown__list").append(d),n.attr("data-value","calendar").html(`
                <span class="dropdown__name">${s}</span>
                <span class="dropdown__value">${c}</span>
            `)}(function t(e){let o=$(`${e} .dropdown__selected`),a=o.attr("data-value"),n=$(`${e} .list__item`);n.removeClass("item__active"),n.filter(`[data-value="${a}"]`).addClass("item__active")})("#optionPeriod")}(t.period),function t(e){let{exNames:o,exTickers:a,percents:n,selectedTicker:i=""}=e,l=`
            <li class="list__item${""===i?" item__active":""}" data-value="">
                <span class="dropdown__name">
                    <img src="/img/exchange/all.webp" alt="all exchanges logo" loading="lazy">All exchanges
                </span>
                <span class="dropdown__value"></span>
            </li>
        `;for(let r=0;r<a.length;r++){let s=a[r],c=o[r],d=n[r],p=s===i?" item__active":"";l+=`
                <li class="list__item${p}" data-value="${s}">
                    <span class="dropdown__name">
                        <img src="/img/exchange/${s}.webp" alt="${c} logo" loading="lazy">${c}
                    </span>
                    <span class="dropdown__value">${d}%</span>
                </li>
            `}S=i,$("#optionExchange .dropdown__list").html(l);let h=$(`#optionExchange .list__item[data-value="${i}"]`),f=h.length?h.html():'<span class="dropdown__name"><img src="/img/exchange/all.webp" alt="all exchanges logo" loading="lazy">All exchanges</span><span class="dropdown__value"></span>';$("#optionExchange .dropdown__selected").attr("data-value",i).html(f)}(t.chart.exchanges),function t(e){let o=$('table[itemprop="dataset"] tbody');o.empty();let a=e.walletTier.map((t,o)=>{let a=o===e.idxMax?' class="row_highlight"':"";return`
                <tr itemscope itemtype="https://schema.org/ListItem"${a}>
                    <td itemprop="name">${t}</td>
                    <td itemprop="additionalType"><b>${e.walletSize[o]}</b></td>
                    <td><b>${e.marketShare[o]}</b></td>
                    <td>${e.buys[o]}</td>
                    <td>${e.sells[o]}</td>
                    <td itemprop="value">${e.netWorth[o]}</td>
                </tr>`});o.append(a.join(""))}(t.chart.byWallet)}function B(t){$("body").removeClass("loaded"),setTimeout(function(){"function"==typeof t&&t()},50)}v.one("focus",function(){var t;E||(t=()=>{(function t(){let e="";for(let o=0;o<I.length;o++){let a=I[o];e+=`<li data-symbol="${a}">${a}</li>`}k[0].innerHTML=e,E=!0})()},$.getJSON("/js/coins.json",function(e){I=e,t()}))}),v.on("input",function(){let t=v.val().toLowerCase(),e=0;if(v.val(v.val().toUpperCase()),M.length||(M=k.find("li")),M.each(function(){let o=$(this),a=o.data("symbol").toLowerCase();if(a.includes(t)&&e<3){if(o.show(),0===o.find("img").length){let n=`https://www.gate.io/images/coin_icon/64/${a}.png`,i=new Image;i.src=n,i.loading="lazy",o.prepend(i)}e++}else o.hide()}),k.show(),""===v.val())w.html('<img src="/img/coin/_ghost.png" />');else{let o=v.val().toUpperCase();if(I.includes(o)){let a=`https://www.gate.io/images/coin_icon/64/${t}.png`;w.find("img").attr("src",a)}else w.find("img").attr("src","/img/coin/_ghost_moving.png")}C=-1,M.removeClass("dropdown__selected")}),v.keydown(function(t){if(38==t.keyCode){t.preventDefault();for(let e=C-1;e>=0;e--)if(M.eq(e).is(":visible")){C=e;break}}else if(40==t.keyCode){t.preventDefault();for(let o=C+1;o<M.length;o++)if(M.eq(o).is(":visible")){C=o;break}}else 13==t.keyCode?(t.preventDefault(),C>-1)?M.eq(C).trigger("click"):(k.hide(),W.submit()):27==t.keyCode&&(t.preventDefault(),k.hide(),C=-1);M.removeClass("dropdown__selected"),C>-1&&M.eq(C).addClass("dropdown__selected")}),k.on("click","li",function(){let t=$(this),e=t.data("symbol").toUpperCase(),o=t.find("img").attr("src");w.find("img").attr("src",o),k.hide(),v.val(e),C=-1}),w.on("click",function(){v.focus()}),$(document).on("click",function(t){$(t.target).closest(v,k).length||k.hide()}),R(corydoData),W.on("submit",function(t){t.preventDefault(),formData=function t(){O.val(v.val().toLowerCase());let e={coin:O.val(),exchange:S,date:_,period:y};return e}(),console.log(formData);let e=`/${formData.coin}-prediction/`,o=new URLSearchParams;formData.exchange&&o.set("ex",formData.exchange),formData.date&&o.set("d",formData.date),formData.period&&o.set("p",formData.period);let a=o.toString()?`${e}?${o.toString()}`:e;D.val(window.location.hostname+a),history.pushState(null,"",a),formData.coin===i.tickerLower?$.ajax({type:"GET",url:"/data"+a,dataType:"json",success:function(t){console.clear(),console.log(t),N(n=t.chart),P(t),R(t)},error:function(t){console.error("~~~ API is not received")}}):B(function(){window.location.href=a})}),window.addEventListener("popstate",function(t){let e=window.location.pathname+window.location.search;D.val(window.location.hostname+e);let o=new URLSearchParams(window.location.search);urlDateParam=o.get("d"),urlPeriodParam=o.get("p"),urlExchangeParam=o.get("ex"),$.ajax({type:"GET",url:"/data"+e,dataType:"json",success:function(t){console.clear(),console.log(t),N(n=t.chart),P(t),R(t)},error:function(t){console.error("~~~ API is not received")}})}),$(document).on("click",'a[href]:not([target="_blank"]):not([href^="#"])',function(t){let e=$(this).attr("href");!e||e.startsWith("javascript:")||(t.preventDefault(),B(function(){window.location.href=e}))}),$(document).on("click","[data-href]",function(t){let e=$(this).data("href");!e||e.startsWith("javascript:")||(t.preventDefault(),B(function(){window.location.href=e}))})});